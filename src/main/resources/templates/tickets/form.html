<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Покупка билета</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container">
            <a class="navbar-brand" href="/home"><i class="bi bi-film"></i> Кинотеатр</a>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Покупка билета</h2>
        
        <div class="card">
            <div class="card-body">
                <form th:action="@{/tickets}" method="post">
                    <div class="mb-3">
                        <label class="form-label">Сеанс *</label>
                        <select class="form-select" name="sessionId" required>
                            <option value="">Выберите сеанс...</option>
                <option th:each="sess : ${sessions}" 
                    th:value="${sess.id}" 
                    th:text="${sess.movie.title + ' - ' + sess.hall.name + ' (' + #temporals.format(sess.startTime, 'dd.MM.yyyy HH:mm') + ')'}"
                    th:selected="${selectedSession != null && selectedSession.id == sess.id}"></option>
                        </select>
                    </div>
                    <div class="mb-3" th:if="${selectedSession != null}">
                        <label class="form-label">Место *</label>
                        <input type="number" class="form-control" name="seatNumber" 
                               min="1" th:max="${selectedSession.hall.capacity}" required>
                        <small class="form-text text-muted">
                            Доступно мест: <span th:text="${selectedSession.availableSeats}"></span> из 
                            <span th:text="${selectedSession.hall.capacity}"></span>
                        </small>
                    </div>
                    <div class="mb-3" th:unless="${selectedSession != null}">
                        <label class="form-label">Место *</label>
                        <input type="number" class="form-control" name="seatNumber" min="1" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="bi bi-cart"></i> Купить</button>
                    <a href="/tickets" class="btn btn-secondary">Отмена</a>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.querySelector('select[name="sessionId"]').addEventListener('change', function() {
            if (this.value) {
                window.location.href = '/tickets/new?sessionId=' + this.value;
            }
        });
    </script>
</body>
</html>

